<div class="list-container">
  <h2>Gestion des Utilisateurs</h2>

  <table mat-table [dataSource]="users$" class="mat-elevation-z8">

    <ng-container matColumnDef="avatar">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let user">
        <img [src]="user.avatarUrl || 'assets/welcome/profile.svg'" alt="Avatar" class="user-avatar">
      </td>
    </ng-container>

    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef> Nom </th>
      <td mat-cell *matCellDef="let user"> {{user.name}} </td>
    </ng-container>

    <ng-container matColumnDef="email">
      <th mat-header-cell *matHeaderCellDef> Email </th>
      <td mat-cell *matCellDef="let user"> {{user.email}} </td>
    </ng-container>

    <ng-container matColumnDef="role">
      <th mat-header-cell *matHeaderCellDef> Rôle </th>
      <td mat-cell *matCellDef="let user">
        <span class="role-chip" [ngClass]="user.role.toLowerCase()">{{ user.role }}</span>
      </td>
    </ng-container>

        <!-- NOUVELLE COLONNE : Statut -->
    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef> Statut </th>
      <td mat-cell *matCellDef="let user">
        <span class="status-indicator" [class.enabled]="user.enabled" [class.disabled]="!user.enabled">
          {{ user.enabled ? 'Actif' : 'Désactivé' }}
        </span>
      </td>
    </ng-container>


    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef> Actions </th>
      <td mat-cell *matCellDef="let user">
        <!-- Bouton Activer/Désactiver Conditionnel -->
        <button *ngIf="user.enabled" mat-icon-button color="accent" (click)="toggleUserStatus(user)" matTooltip="Désactiver le compte">
          <mat-icon>toggle_on</mat-icon>
        </button>
        <button *ngIf="!user.enabled" mat-icon-button (click)="toggleUserStatus(user)" matTooltip="Activer le compte">
          <mat-icon>toggle_off</mat-icon>
        </button>
        <button mat-icon-button color="warn" (click)="deleteUser(user.id, user.name)" matTooltip="Supprimer l'utilisateur">
          <mat-icon>delete_forever</mat-icon>
        </button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>
  
  <div *ngIf="!(users$ | async)?.length" class="empty-state">
    <p>Aucun utilisateur trouvé.</p>
  </div>
</div>