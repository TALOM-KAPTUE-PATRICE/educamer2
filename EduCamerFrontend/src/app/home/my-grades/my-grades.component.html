<div class="my-grades-container">
    <header class="page-header">
        <h1>Mes Notes</h1>
        <p>Consultez vos résultats pour chaque cours.</p>
    </header>

    <div *ngIf="coursesWithGrades$ | async as items; else loading">
        <div *ngIf="items.length > 0; else noGrades">
            <mat-accordion>
                <mat-expansion-panel *ngFor="let item of items">
                    <mat-expansion-panel-header>
                        <mat-panel-title>{{ item.course.title }}</mat-panel-title>
                        <mat-panel-description>Moyenne : {{ item.gradebook.averageGrade | number:'1.1-1' }} /
                            20</mat-panel-description>
                    </mat-expansion-panel-header>

                    <table mat-table [dataSource]="item.gradebook.grades">
                        <!-- Définition des colonnes -->
                        <ng-container matColumnDef="title">
                            <th mat-header-cell *matHeaderCellDef> Devoir </th>
                            <td mat-cell *matCellDef="let e"> {{e.assignmentTitle}} </td>
                        </ng-container>
                        <ng-container matColumnDef="grade">
                            <th mat-header-cell *matHeaderCellDef> Note </th>
                            <td mat-cell *matCellDef="let e"> {{e.grade !== null ? (e.grade | number:'1.1-1') + '/20' :
                                'En attente'}} </td>
                        </ng-container>
                        <ng-container matColumnDef="date">
                            <th mat-header-cell *matHeaderCellDef> Soumis le </th>
                            <td mat-cell *matCellDef="let e"> {{e.submittedAt | date:'dd/MM/yy'}} </td>
                        </ng-container>
                        <tr mat-header-row *matHeaderRowDef="['title', 'grade', 'date']"></tr>
                        <tr mat-row *matRowDef="let row; columns: ['title', 'grade', 'date'];"></tr>
                    </table>
                </mat-expansion-panel>
            </mat-accordion>
        </div>
        <ng-template #noGrades>
            <p>Aucune note disponible pour le moment.</p>
        </ng-template>
    </div>

    <ng-template #loading>
        <div class="loading-spinner"><mat-spinner></mat-spinner></div>
    </ng-template>
</div>