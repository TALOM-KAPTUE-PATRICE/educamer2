<div class="auth-wrapper">
  <div class="auth-container">
    <div class="illustration-panel">
      <img src="assets/auth/reset-password.svg" alt="Illustration réinitialisation mot de passe">
    </div>
    <div class="form-panel">
      <mat-card class="auth-card">

        <!-- AFFICHER UN SPINNER PENDANT LA VÉRIFICATION DU TOKEN -->
        <div *ngIf="isLoading" class="loading-container">
          <mat-spinner diameter="50"></mat-spinner>
          <p>Vérification du lien...</p>
        </div>

        <!-- AFFICHER LE FORMULAIRE UNIQUEMENT SI LE TOKEN EST VALIDE -->
        <div *ngIf="!isLoading && isTokenValid">
          <div class="logo-container">
            <h1 class="app-logo-text">EduCamer</h1>
          </div>
          <mat-card-header class="auth-card-header">
            <mat-card-title>Choisissez un nouveau mot de passe</mat-card-title>
            <mat-card-subtitle>Assurez-vous qu'il soit sécurisé.</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()">

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Nouveau mot de passe</mat-label>
                <input matInput formControlName="newPassword" type="password" required>
                <mat-error *ngIf="resetPasswordForm.get('newPassword')?.hasError('minlength')">
                  Le mot de passe doit contenir au moins 6 caractères.
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Confirmez le mot de passe</mat-label>
                <input matInput formControlName="confirmPassword" type="password" required>
                <mat-error *ngIf="resetPasswordForm.hasError('passwordMismatch')">
                  Les mots de passe ne correspondent pas.
                </mat-error>
              </mat-form-field>
              <button mat-raised-button color="primary" type="submit"
                [disabled]="resetPasswordForm.invalid || isSubmitting" class="submit-button">
                <div *ngIf="!isSubmitting; else saving">Enregistrer</div>
                <ng-template #saving>
                  <div class="spinner-container">
                    <mat-spinner diameter="24"></mat-spinner>
                    <span>Sauvegarde...</span>
                  </div>
                </ng-template>
              </button>
            </form>
          </mat-card-content>
        </div>

      </mat-card>
    </div>
  </div>
</div>